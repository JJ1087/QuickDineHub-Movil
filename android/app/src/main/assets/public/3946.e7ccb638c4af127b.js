"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3946],{3923:(T,y,u)=>{u.d(y,{$o:()=>p,_G:()=>h,Vq:()=>f,SQ:()=>k});var p=function(l){return l.Loaded="applePayLoaded",l.FailedToLoad="applePayFailedToLoad",l.Completed="applePayCompleted",l.Canceled="applePayCanceled",l.Failed="applePayFailed",l.DidSelectShippingContact="applePayDidSelectShippingContact",l.DidCreatePaymentMethod="applePayDidCreatePaymentMethod",l}(p||{}),h=function(l){return l.Loaded="googlePayLoaded",l.FailedToLoad="googlePayFailedToLoad",l.Completed="googlePayCompleted",l.Canceled="googlePayCanceled",l.Failed="googlePayFailed",l}(h||{}),f=function(l){return l.Loaded="paymentFlowLoaded",l.FailedToLoad="paymentFlowFailedToLoad",l.Opened="paymentFlowOpened",l.Created="paymentFlowCreated",l.Completed="paymentFlowCompleted",l.Canceled="paymentFlowCanceled",l.Failed="paymentFlowFailed",l}(f||{}),k=function(l){return l.Loaded="paymentSheetLoaded",l.FailedToLoad="paymentSheetFailedToLoad",l.Completed="paymentSheetCompleted",l.Canceled="paymentSheetCanceled",l.Failed="paymentSheetFailed",l}(k||{})},3946:(T,y,u)=>{u.r(y),u.d(y,{Tab2PageModule:()=>H});var p=u(4742),h=u(177),f=u(4341),k=u(1307),l=u(691),d=u(467),b=u(8254),e=u(3953),_=u(1626);let S=(()=>{var r;class s{constructor(t){this.http=t,this.apiUrl="https://quickdinehub-back1.onrender.com"}ObtenerProductosCarrito(){var t=this;return(0,d.A)(function*(){const{value:o}=yield b.p.get({key:"userId"}),{value:i}=yield b.p.get({key:"authToken"}),n=new _.Lr({Authorization:`Bearer ${i}`});return t.http.get(`${t.apiUrl}/carrito/${o}`,{headers:n})})()}eliminarDeCarrito(t){var o=this;return(0,d.A)(function*(){const{value:i}=yield b.p.get({key:"userId"}),{value:n}=yield b.p.get({key:"authToken"}),c=new _.Lr({Authorization:`Bearer ${n}`});return o.http.delete(`${o.apiUrl}/eliminar-de-carrito/${i}/${t}`,{headers:c}).toPromise()})()}actualizarCantidadEnBD(t,o){var i=this;return(0,d.A)(function*(){const{value:n}=yield b.p.get({key:"userId"}),{value:c}=yield b.p.get({key:"authToken"}),g=new _.Lr({Authorization:`Bearer ${c}`});return i.http.put(`${i.apiUrl}/comensales/${n}/carrito/cantidad`,{productId:t,cantidad:o},{headers:g}).toPromise()})()}obtenerDatoComensal(t){return this.http.get(`${this.apiUrl}/info-comensalId/${t}`)}}return(r=s).\u0275fac=function(t){return new(t||r)(e.KVO(_.Qq))},r.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),s})();var w=u(5083),v=u(3923);const m=(0,w.F3)("Stripe",{web:()=>u.e(1651).then(u.bind(u,1651)).then(r=>new r.StripeWeb)}),P_stripe_publishableKey="pk_test_51QJ0RlF5yxkLL8z9meIVjdqFZ5deqRAfyqlY71fA3s2cWW8F2M74aDFiik4HAvuoA7ucgjhilMbPw9OqStYMD67q00ePLjKlCk";var I=u(1594),$=u(9350);function x(r,s){const a="object"==typeof s;return new Promise((t,o)=>{let n,i=!1;r.subscribe({next:c=>{n=c,i=!0},error:o,complete:()=>{i?t(n):a?t(s.defaultValue):o(new $.G)}})})}let R=(()=>{var r;class s{constructor(t){this.http=t,this.apiUrl="https://quickdinehub-back1.onrender.com"}obtenerDirecciones(){var t=this;return(0,d.A)(function*(){const{value:o}=yield b.p.get({key:"userId"}),{value:i}=yield b.p.get({key:"authToken"}),n=new _.Lr({Authorization:`Bearer ${i}`});return t.http.get(`${t.apiUrl}/obtener-direcciones/${o}`,{headers:n})})()}crearOrden(t){return this.http.post(`${this.apiUrl}/crear-orden`,t)}obtenerInfoDeProductoPorId(t){return this.http.get(`${this.apiUrl}/info-producto/${t}`)}crearDetalleOrden(t){return this.http.post(`${this.apiUrl}/crear-detalleOrden`,t)}actualizarCantidadProductos(t,o){return console.log("Enviando solicitud de actualizaci\xf3n de cantidad de producto:",t,"y idComensal:",o),this.http.put(`${this.apiUrl}/comensales/${o}/noProductos`,{noProductos1:t})}eliminarOrden(t){return this.http.delete(`${this.apiUrl}/eliminar-orden/${t}`)}actualizarCarrito(t,o){return this.http.put(`${this.apiUrl}/actualizar-carrito`,{comensalId:o,carrito:t})}verificarFeedbackCliente(t){return this.http.get(`${this.apiUrl}/feedbacks/existe/${t}`)}}return(r=s).\u0275fac=function(t){return new(t||r)(e.KVO(_.Qq))},r.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),s})();const j=(r,s)=>({"bg-[#ff8633] hover:bg-[#ff6133]":r,"bg-[#ff8633]/50":s}),V=(r,s)=>({colonia:r,idDireccion:s});function E(r,s){if(1&r&&(e.j41(0,"option",16),e.EFF(1),e.k0s()),2&r){const a=s.$implicit;e.Y8G("ngValue",e.l_i(5,V,a.colonia,a._id)),e.R7$(),e.LHq(" ",a.colonia,", ",a.calle,", ",a.noCasa,", (",a.datoExtra,") ")}}function A(r,s){if(1&r){const a=e.RV6();e.j41(0,"div",1),e.nrm(1,"div",2),e.j41(2,"div",3)(3,"div",4)(4,"button",5),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.closeModal())}),e.j41(5,"span",6),e.EFF(6,"Cerrar"),e.k0s(),e.nrm(7,"ion-icon",7),e.k0s(),e.j41(8,"div",8)(9,"h2",9),e.EFF(10,"Paga tu compra"),e.k0s(),e.j41(11,"p",10),e.EFF(12,"Selecciona tu direcci\xf3n"),e.k0s(),e.j41(13,"select",11),e.mxI("ngModelChange",function(o){e.eBV(a);const i=e.XpG();return e.DH7(i.coloniaSeleccionada,o)||(i.coloniaSeleccionada=o),e.Njj(o)}),e.bIt("change",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.seleccionarDireccion())}),e.DNE(14,E,2,8,"option",12),e.k0s(),e.j41(15,"p",10),e.EFF(16,"Paga el total del carrito"),e.k0s(),e.j41(17,"p",13),e.EFF(18),e.k0s(),e.j41(19,"div",14)(20,"button",15),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.paymentSheet())}),e.EFF(21,"Pagar con tarjeta de credito"),e.k0s(),e.j41(22,"button",15),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.googlePay())}),e.EFF(23,"Pagar con Google Pay"),e.k0s()()()()()()}if(2&r){const a=e.XpG();e.R7$(13),e.R50("ngModel",a.coloniaSeleccionada),e.R7$(),e.Y8G("ngForOf",a.direcciones),e.R7$(4),e.SpI("Total: $",a.totalCompra,""),e.R7$(2),e.Y8G("ngClass",e.l_i(7,j,!a.botonesDeshabilitados,a.botonesDeshabilitados))("disabled",a.botonesDeshabilitados),e.R7$(2),e.Y8G("ngClass",e.l_i(10,j,!a.botonesDeshabilitados,a.botonesDeshabilitados))("disabled",a.botonesDeshabilitados)}}let G=(()=>{var r;class s{constructor(t,o,i,n){this.pasarelaService=t,this.http=o,this.toastController=i,this.loadingController=n,this.totalCompra=0,this.carritoConsulta=[],this.carritoVaciado=new e.bkB,this.abrirFeedback=new e.bkB,this.idCliente="",this.isVisible=!1,this.data={},this.direcciones=[],this.coloniaSeleccionada="",this.colonia="",this.idDireccion="",this.botonesDeshabilitados=!0,this.idRepartidor="000000000000000000000000",this.precioEnvio1=30,this.idCuentaBanco="661eca01ef4332700659bb16",this.noProductos1=1,m.initialize({publishableKey:P_stripe_publishableKey})}openModal(){this.isVisible=!0}closeModal(){this.isVisible=!1}presentToast(t,o){var i=this;return(0,d.A)(function*(){yield(yield i.toastController.create({message:t,duration:3e3,position:"top",color:o})).present()})()}presentLoading(){var t=this;return(0,d.A)(function*(){yield(yield t.loadingController.create({message:"Creando Orden...",spinner:"circles"})).present()})()}dismissLoading(){var t=this;return(0,d.A)(function*(){yield t.loadingController.dismiss()})()}ngOnInit(){this.cargarUsuario(),this.obtenerDirecciones(),this.botonesDeshabilitados=!0}obtenerDirecciones(){var t=this;return(0,d.A)(function*(){try{(yield t.pasarelaService.obtenerDirecciones()).subscribe(i=>{t.direcciones=i,console.log("Direcciones recibidas:",t.direcciones)},i=>{console.error("Error al obtener las direcciones:",i),t.presentToast("Error de conexion a la red. Error al obtener las direcciones","danger")})}catch(o){console.error("Error al ejecutar obtenerDirecciones",o),t.presentToast("Error de conexion a la red. Error al ejecutar obtenerDirecciones","danger")}})()}seleccionarDireccion(){const t=this.coloniaSeleccionada;this.colonia=t.colonia,this.idDireccion=t.idDireccion,console.log("Colonia seleccionada:",this.colonia),console.log("idDireccion:",this.idDireccion),console.log("Colonia Seleccionada:",this.coloniaSeleccionada),console.log("totalCompra: ",this.totalCompra),console.log("carrito2: ",this.carritoConsulta),this.data={name:"QuickDH",email:"QuickDH@gmail.com",amount:100*this.totalCompra,currency:"mxn"},this.botonesDeshabilitados=!1}cargarUsuario(){var t=this;return(0,d.A)(function*(){const{value:o}=yield b.p.get({key:"userId"});o&&(t.idCliente=o)})()}httpPost(t){return this.http.post("https://quickdinehub-back1.onrender.com/payment-sheet",t).pipe((0,I.$)())}splitAndJoin(t){const o=t.split("").slice(0,2).join("");return console.log(o),o}paymentSheet(){var t=this;return(0,d.A)(function*(){if(console.log("Se toma el id de usuario?:",t.idCliente),t.data.amount)try{m.addListener(v.SQ.Completed,()=>{console.log("PaymentSheetEventsEnum.Completed Fase 1")});const o=t.httpPost(t.data),{paymentIntent:i,ephemeralKey:n,customer:c}=yield x(o);console.log("Fase 2"),yield m.createPaymentSheet({paymentIntentClientSecret:i,customerId:c,customerEphemeralKeySecret:n,merchantDisplayName:"QuickDineHub"}),console.log("Fase 3");const g=yield m.presentPaymentSheet();console.log("Fase 4"),g&&g.paymentResult===v.SQ.Completed&&(console.log("Fase 5"),t.splitAndJoin(i),console.log("Fase 7"),yield t.realizarCompra(),console.log("Fase 8"))}catch(o){console.log(o)}else console.error("Error: datos de pago incompletos")})()}googlePay(){var t=this;return(0,d.A)(function*(){if(void 0===m.isGooglePayAvailable().catch(()=>{}))return;m.addListener(v._G.Completed,()=>{console.log("GooglePayEventsEnum.Completed")});const i=t.httpPost(t.data),{paymentIntent:n}=yield x(i);yield m.createGooglePay({paymentIntentClientSecret:n,paymentSummaryItems:[{label:"QuickDH",amount:t.totalCompra}],merchantIdentifier:"QuickDH",countryCode:"MX",currency:"MXN"}),(yield m.presentGooglePay()).paymentResult===v._G.Completed&&(t.splitAndJoin(n),t.realizarCompra())})()}paymentFlow(){var t=this;return(0,d.A)(function*(){m.addListener(v.Vq.Completed,()=>{console.log("PaymentFlowEventsEnum.Completed")});const o=t.httpPost(t.data),{paymentIntent:i,ephemeralKey:n,customer:c}=yield x(o);yield m.createPaymentFlow({paymentIntentClientSecret:i,customerEphemeralKeySecret:n,customerId:c,merchantDisplayName:"Jeziel"});const g=yield m.presentPaymentFlow();console.log("presentResult: ",g);const F=yield m.confirmPaymentFlow();console.log("confirmResult: ",F),F.paymentResult===v.Vq.Completed&&t.splitAndJoin(i)})()}Inicio(){this.realizarCompra()}realizarCompra(){this.presentLoading();const t=this.agruparProductosPorRestaurante();for(const o in t)if(t.hasOwnProperty(o)){const i=t[o];console.log("verificaciond e restuarante ID 2: ",i),this.crearOrdenParaRestaurante(i),console.log("crearOrdenParaRestaurante LLamado")}}agruparProductosPorRestaurante(){const t={};for(const o of this.carritoConsulta)t[o.idRestaurante]||(t[o.idRestaurante]=[]),t[o.idRestaurante].push(o);return t}crearOrdenParaRestaurante(t){t.length>0&&this.crearOrden(t[0].idRestaurante,t)}crearOrden(t,o){const i={idCliente:this.idCliente,idRestaurante:t,idRepartidor:this.idRepartidor,idDireccion:this.idDireccion,idCuentaBanco:this.idCuentaBanco,costoEnvio:this.precioEnvio1,precioTotal:this.totalCompra};console.log("DATOS DE LA NUEVA ORDEN :",i),this.pasarelaService.crearOrden(i).subscribe(n=>{console.log("Orden creada exitosamente:",n);const c=n._id;console.log("Id de la nueva orden:",c),this.crearDetallesOrden(c,o)},n=>{console.error("Error al crear la orden:",n),this.presentToast("Error al crear la orden","danger")})}crearDetallesOrden(t,o){console.log("Detalle de orden llegando a funcion:",o),o.length>1&&(this.noProductos1=2),o.forEach(i=>{this.pasarelaService.obtenerInfoDeProductoPorId(i.productId).subscribe(n=>{const c=Number(n.precio.$numberDecimal);console.log("DATA:",i);const F={idOrden:t,idProducto:i.productId,nombreProducto:n.nombre,descripcionProducto:n.descripcion,cantidadProducto:i.cantidad,costoUnidad:n.precio,subtotal:c*i.cantidad,especificacion:i.especificacion};console.log("Detalle de orden creado exitosamente:",F),this.pasarelaService.crearDetalleOrden(F).subscribe(D=>{console.log("Detalle de orden creado exitosamente:",D),2===this.noProductos1&&this.actualizarCantidadProductos(t),this.vaciarCarrito()},D=>{console.error("Error al crear el detalle de orden:",D),this.eliminarOrdenCreada(t),this.presentToast("Error al crear el detalle de orden","danger")})},n=>{console.error("Error al obtener la informaci\xf3n del producto:",n),this.presentToast("Error al obtener la informaci\xf3n del producto","danger")})})}actualizarCantidadProductos(t){this.pasarelaService.actualizarCantidadProductos(this.noProductos1,t).subscribe(o=>{console.log("Numero productos actualizado en la base de datos:",o),this.noProductos1=1},o=>{console.error("Error al actualizar la cantidad en la base de datos Beto:",o),this.noProductos1=1})}eliminarOrdenCreada(t){console.log("Id que se quiere eliminar: ",t),this.pasarelaService.eliminarOrden(t).subscribe(o=>{console.log("Orden eliminada exitosamente:",o)},o=>{console.error("Error al eliminar la orden:",o)})}vaciarCarrito(){console.log("Carrito:",this.idCliente),this.pasarelaService.actualizarCarrito([],this.idCliente).subscribe(o=>{this.dismissLoading(),this.isVisible=!1,this.botonesDeshabilitados=!0,this.presentToast("Compra exitosa","success"),this.carritoVaciado.emit(),this.pasarelaService.verificarFeedbackCliente(this.idCliente).subscribe(i=>{i||this.abrirFeedback.emit()},i=>{console.error("Error al verificar feedback:",i)})},o=>{console.error("Error al vaciar el carrito:",o)})}}return(r=s).\u0275fac=function(t){return new(t||r)(e.rXU(R),e.rXU(_.Qq),e.rXU(p.K_),e.rXU(p.Xi))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-pasarela-pagos"]],inputs:{totalCompra:"totalCompra",carritoConsulta:"carritoConsulta"},outputs:{carritoVaciado:"carritoVaciado",abrirFeedback:"abrirFeedback"},decls:1,vars:1,consts:[["class","relative z-10","role","dialog","aria-modal","true",4,"ngIf"],["role","dialog","aria-modal","true",1,"relative","z-10"],["aria-hidden","true",1,"fixed","inset-0","bg-gray-500","bg-opacity-75","transition-opacity"],[1,"fixed","inset-0","z-10","w-screen","overflow-y-auto","flex","justify-center","items-center","p-4","sm:p-6","md:p-8"],[1,"relative","bg-white","rounded-lg","shadow-2xl","p-4","sm:p-6","md:p-8","max-w-xs","sm:max-w-md","md:max-w-lg","w-full","mx-4","sm:mx-auto"],["type","button",1,"absolute","top-4","right-4","text-gray-400","hover:text-gray-500",3,"click"],[1,"sr-only"],["name","close-outline",1,"text-2xl"],[1,"text-center"],[1,"text-lg","sm:text-xl","md:text-2xl","font-bold","text-gray-900","mb-1"],[1,"text-gray-500","mb-4","text-sm","sm:text-base"],[1,"w-full","border","border-[#ff8633]","text-gray-900","p-2","rounded","mb-4","focus:outline-none","focus:ring-2","focus:ring-[#ff6133]",3,"ngModelChange","change","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"text-lg","font-semibold","text-gray-900","mb-6"],[1,"space-y-2"],["expand","block",1,"w-full","text-white","font-bold","py-1","sm:py-2","md:py-3","mt-3","rounded",3,"click","ngClass","disabled"],[3,"ngValue"]],template:function(t,o){1&t&&e.DNE(0,A,24,13,"div",0),2&t&&e.Y8G("ngIf",o.isVisible)},dependencies:[p.iq,h.YU,h.Sq,h.bT,f.xH,f.y7,f.wz,f.BC,f.vS]}),s})(),U=(()=>{var r;class s{constructor(t){this.http=t,this.apiUrl="https://quickdinehub-back1.onrender.com"}enviarFeedback(t,o,i,n){return this.http.post(`${this.apiUrl}/feedback`,{idCliente:t,respuestaUno:o,respuestaDos:i,respuestaTres:n})}}return(r=s).\u0275fac=function(t){return new(t||r)(e.KVO(_.Qq))},r.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"}),s})();const C=(r,s)=>({"bg-orange-300":r,"bg-gray-100 hover:bg-gray-200":s}),L=(r,s)=>({"bg-[#ff8633] hover:bg-[#ff6133]":r,"bg-[#ff8633]/50":s});function B(r,s){if(1&r){const a=e.RV6();e.j41(0,"div",1),e.nrm(1,"div",2),e.j41(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"div",7)(7,"h2",8)(8,"span",9),e.EFF(9,"Ay\xfadanos"),e.k0s(),e.EFF(10," a mejorar"),e.k0s(),e.j41(11,"div",10)(12,"p",11),e.EFF(13,"\xbfConsideras que los pasos para completar tu compra fueron claros?"),e.k0s(),e.j41(14,"div",12)(15,"button",13),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.selectAnswer("claridadCompra",3))}),e.EFF(16," \u{1f929} "),e.k0s(),e.j41(17,"button",13),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.selectAnswer("claridadCompra",2))}),e.EFF(18," \u{1f642} "),e.k0s(),e.j41(19,"button",13),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.selectAnswer("claridadCompra",1))}),e.EFF(20," \u{1f61e} "),e.k0s()()(),e.j41(21,"div",10)(22,"p",11),e.EFF(23,"\xbfEl dise\xf1o de la aplicaci\xf3n te result\xf3 visualmente agradable?"),e.k0s(),e.j41(24,"div",12)(25,"button",13),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.selectAnswer("disenoAgradable",3))}),e.EFF(26," \u{1f929} "),e.k0s(),e.j41(27,"button",13),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.selectAnswer("disenoAgradable",2))}),e.EFF(28," \u{1f642} "),e.k0s(),e.j41(29,"button",13),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.selectAnswer("disenoAgradable",1))}),e.EFF(30," \u{1f61e} "),e.k0s()()(),e.j41(31,"div",10)(32,"p",11),e.EFF(33,"\xbfTe result\xf3 conveniente el uso de esta aplicaci\xf3n?"),e.k0s(),e.j41(34,"div",12)(35,"button",13),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.selectAnswer("usoConveniente",3))}),e.EFF(36," \u{1f929} "),e.k0s(),e.j41(37,"button",13),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.selectAnswer("usoConveniente",2))}),e.EFF(38," \u{1f642} "),e.k0s(),e.j41(39,"button",13),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.selectAnswer("usoConveniente",1))}),e.EFF(40," \u{1f61e} "),e.k0s()()(),e.j41(41,"div",14)(42,"button",15),e.bIt("click",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.Evaluar())}),e.EFF(43," Enviar "),e.k0s()()()()()()()()}if(2&r){const a=e.XpG();e.R7$(15),e.Y8G("ngClass",e.l_i(11,C,3===a.respuestaUno,3!==a.respuestaUno)),e.R7$(2),e.Y8G("ngClass",e.l_i(14,C,2===a.respuestaUno,2!==a.respuestaUno)),e.R7$(2),e.Y8G("ngClass",e.l_i(17,C,1===a.respuestaUno,1!==a.respuestaUno)),e.R7$(6),e.Y8G("ngClass",e.l_i(20,C,3===a.respuestaDos,3!==a.respuestaDos)),e.R7$(2),e.Y8G("ngClass",e.l_i(23,C,2===a.respuestaDos,2!==a.respuestaDos)),e.R7$(2),e.Y8G("ngClass",e.l_i(26,C,1===a.respuestaDos,1!==a.respuestaDos)),e.R7$(6),e.Y8G("ngClass",e.l_i(29,C,3===a.respuestaTres,3!==a.respuestaTres)),e.R7$(2),e.Y8G("ngClass",e.l_i(32,C,2===a.respuestaTres,2!==a.respuestaTres)),e.R7$(2),e.Y8G("ngClass",e.l_i(35,C,1===a.respuestaTres,1!==a.respuestaTres)),e.R7$(3),e.Y8G("disabled",a.botonesDeshabilitados)("ngClass",e.l_i(38,L,!a.botonesDeshabilitados,a.botonesDeshabilitados))}}let O=(()=>{var r;class s{constructor(t,o){this.FDService=t,this.loadingController=o,this.isVisible=!1,this.botonesDeshabilitados=!0,this.idCliente="",this.claridadCompraSeleccionada=!1,this.disenoAgradableSeleccionado=!1,this.usoConvenienteSeleccionado=!1,this.respuestaUno=null,this.respuestaDos=null,this.respuestaTres=null}openModal(){this.isVisible=!0}closeModal(){this.isVisible=!1}cargarUsuario(){var t=this;return(0,d.A)(function*(){const{value:o}=yield b.p.get({key:"userId"});o&&(t.idCliente=o)})()}presentLoading(){var t=this;return(0,d.A)(function*(){yield(yield t.loadingController.create({message:"Guardando respuestas...",spinner:"circles"})).present()})()}dismissLoading(){var t=this;return(0,d.A)(function*(){yield t.loadingController.dismiss()})()}ngOnInit(){}selectAnswer(t,o){switch(this.cargarUsuario(),t){case"claridadCompra":this.claridadCompraSeleccionada=!0,this.respuestaUno=o;break;case"disenoAgradable":this.disenoAgradableSeleccionado=!0,this.respuestaDos=o;break;case"usoConveniente":this.usoConvenienteSeleccionado=!0,this.respuestaTres=o}this.checkAllSelected()}checkAllSelected(){this.botonesDeshabilitados=!(this.claridadCompraSeleccionada&&this.disenoAgradableSeleccionado&&this.usoConvenienteSeleccionado)}Evaluar(){this.presentLoading(),this.idCliente&&null!==this.respuestaUno&&null!==this.respuestaDos&&null!==this.respuestaTres&&(console.log("FeedBack: ",this.idCliente,this.respuestaUno,this.respuestaDos,this.respuestaTres),this.FDService.enviarFeedback(this.idCliente,this.respuestaUno,this.respuestaDos,this.respuestaTres).subscribe({next:()=>{console.log("Feedback enviado correctamente"),this.resetForm()},error:t=>{console.error("Error al enviar feedback",t),this.dismissLoading()}}))}resetForm(){this.dismissLoading(),this.botonesDeshabilitados=!0,this.claridadCompraSeleccionada=!1,this.disenoAgradableSeleccionado=!1,this.usoConvenienteSeleccionado=!1,this.respuestaUno=null,this.respuestaDos=null,this.respuestaTres=null,this.isVisible=!1}}return(r=s).\u0275fac=function(t){return new(t||r)(e.rXU(U),e.rXU(p.Xi))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-feedback-formulario"]],decls:1,vars:1,consts:[["class","relative z-10","role","dialog","aria-modal","true",4,"ngIf"],["role","dialog","aria-modal","true",1,"relative","z-10"],["aria-hidden","true",1,"fixed","inset-0","bg-gray-500","bg-opacity-75","transition-opacity","md:block"],[1,"fixed","inset-0","z-10","w-screen","overflow-y-auto"],[1,"flex","min-h-full","items-stretch","justify-center","text-center","md:items-center","md:px-2","lg:px-4"],[1,"flex","w-full","transform","text-left","text-base","transition","md:my-8","md:max-w-2xl","md:px-4","lg:max-w-4xl"],[1,"relative","flex","w-full","items-center","overflow-hidden","bg-white","px-4","pb-8","pt-14","shadow-2xl","sm:px-6","sm:pt-8","md:p-6","lg:p-8"],[1,"w-full"],[1,"text-2xl","font-bold","text-gray-900","text-center","mb-4"],[1,"font-bold",2,"color","#ff8633"],[1,"mb-6","text-center"],[1,"text-gray-800","mb-2"],[1,"flex","justify-center","mt-2","space-x-4"],[1,"text-2xl","px-4","py-2","rounded-full",3,"click","ngClass"],[1,"flex","justify-center","mt-6"],[1,"text-white","px-4","py-2","rounded","font-bold","shadow-md","w-full","sm:w-auto",3,"click","disabled","ngClass"]],template:function(t,o){1&t&&e.DNE(0,B,44,41,"div",0),2&t&&e.Y8G("ngIf",o.isVisible)},dependencies:[h.YU,h.bT]}),s})();const z=["quickview"],N=["feedback"],X=(r,s)=>({"bg-[#ff8633] hover:bg-[#ff6133]":r,"bg-[#ff8633]/50":s});function M(r,s){if(1&r){const a=e.RV6();e.j41(0,"div",19),e.nrm(1,"img",20),e.j41(2,"div",21)(3,"h2",22),e.EFF(4),e.k0s(),e.j41(5,"p",23),e.EFF(6),e.k0s()(),e.j41(7,"div",24)(8,"button",25),e.bIt("click",function(){const o=e.eBV(a).$implicit,i=e.XpG();return e.Njj(i.actualizarCantidad("-",o.productId,o.cantidad))}),e.nrm(9,"ion-icon",26),e.k0s(),e.j41(10,"span",27),e.EFF(11),e.k0s(),e.j41(12,"button",25),e.bIt("click",function(){const o=e.eBV(a).$implicit,i=e.XpG();return e.Njj(i.actualizarCantidad("+",o.productId,o.cantidad))}),e.nrm(13,"ion-icon",28),e.k0s(),e.j41(14,"button",25),e.bIt("click",function(){const o=e.eBV(a).$implicit,i=e.XpG();return e.Njj(i.eliminarDeCarrito(o.productId))}),e.nrm(15,"ion-icon",29),e.k0s()()()}if(2&r){const a=s.$implicit,t=e.XpG();e.R7$(),e.FS9("alt",a.nombreProducto),e.Y8G("src",t.getImageUrl(a.imagen[0]),e.B4B),e.R7$(3),e.JRh(a.nombreProducto),e.R7$(2),e.SpI("Subtotal: $",a.subtotal,""),e.R7$(5),e.JRh(a.cantidad)}}const Y=[{path:"",component:(()=>{var r;class s{constructor(t,o,i){this.carritoService=t,this.toastController=o,this.loadingController=i,this.subtotalCompra=0,this.envio=0,this.totalCompra=0,this.productosCarrito=[],this.comensalId="",this.botonesDeshabilitados=!0,this.carritoConsulta=[]}presentToast(t){var o=this;return(0,d.A)(function*(){yield(yield o.toastController.create({message:t,duration:3e3,position:"top",color:"danger"})).present()})()}presentLoading(){var t=this;return(0,d.A)(function*(){yield(yield t.loadingController.create({message:"Cargando productos...",spinner:"circles"})).present()})()}dismissLoading(){var t=this;return(0,d.A)(function*(){yield t.loadingController.dismiss()})()}ngOnInit(){this.cargarUsuario()}ionViewWillEnter(){this.cargarProductosCarrito(),this.obtenerDatoComensal()}cargarUsuario(){var t=this;return(0,d.A)(function*(){const{value:o}=yield b.p.get({key:"userId"});o&&(t.comensalId=o)})()}cargarProductosCarrito(){var t=this;return(0,d.A)(function*(){t.presentLoading();try{(yield t.carritoService.ObtenerProductosCarrito()).subscribe(o=>{t.dismissLoading(),t.productosCarrito=o.carrito,console.log("carrito:",t.productosCarrito),t.calcularSubtotal()})}catch(o){t.dismissLoading(),t.presentToast("Problema de conexi\xf3n a la red..."),console.error("Error al cargar los productos del carrito",o)}})()}getImageUrl(t){return`https://quickdinehub-back1.onrender.com/${t}`}eliminarDeCarrito(t){var o=this;return(0,d.A)(function*(){try{yield o.carritoService.eliminarDeCarrito(t),o.cargarProductosCarrito()}catch(i){o.presentToast("Problema de red. No se ha podido eliminar producto del carrito..."),console.error("Error al eliminar producto del carrito:",i)}})()}actualizarCantidad(t,o,i){var n=this;return(0,d.A)(function*(){let c=i;if("+"===t?c++:"-"===t&&c--,c>=1)try{yield n.carritoService.actualizarCantidadEnBD(o,c),n.cargarProductosCarrito()}catch(g){console.error("Error al actualizar la cantidad del producto:",g)}else n.presentToast("No puedes continuar restando..."),console.log("No puedes continuar restando...")})()}calcularSubtotal(){this.subtotalCompra=this.productosCarrito.reduce((t,o)=>t+o.subtotal,0),this.subtotalCompra<1?(this.envio=0,this.totalCompra=0,this.botonesDeshabilitados=!0):(this.envio=30,this.totalCompra=this.subtotalCompra+30,this.botonesDeshabilitados=!1)}obtenerDatoComensal(){console.log("Elementos en el carritoF: ",this.carritoConsulta),this.comensalId?this.carritoService.obtenerDatoComensal(this.comensalId).subscribe(t=>{this.cliente=t,console.log("Datos comensal recibidas",this.cliente),this.carritoConsulta=this.cliente.carrito,console.log("Carrito del comensal:",this.carritoConsulta)},t=>{console.error("Error al obtener las direcciones:",t)}):console.log("No se esta recibiendo el id del cliente")}mostrarModalFeedback(){console.log("Mostrar formulario AFUERITAAAAA"),this.feedback.openModal()}}return(r=s).\u0275fac=function(t){return new(t||r)(e.rXU(S),e.rXU(p.K_),e.rXU(p.Xi))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-tab2"]],viewQuery:function(t,o){if(1&t&&(e.GBs(z,5),e.GBs(N,5)),2&t){let i;e.mGM(i=e.lsd())&&(o.quickview=i.first),e.mGM(i=e.lsd())&&(o.feedback=i.first)}},decls:36,vars:12,consts:[["quickview",""],["feedback",""],[1,"flex","flex-col","justify-between",3,"fullscreen"],[1,"flex","items-center","space-x-4","p-2","sm:p-4","md:p-6"],["src","assets/icon/logo-empresa.png","alt","Foto de perfil",1,"w-[3.5rem]","h-[3.5rem]","sm:w-[4.5rem]","sm:h-[4.5rem]","md:w-[5.5rem]","md:h-[5.5rem]","rounded-full"],[1,"text-md","sm:text-lg","md:text-xl","font-semibold","text-gray-900"],[1,"px-4","py-2","sm:px-6","md:px-8","text-center"],[1,"text-xl","sm:text-2xl","md:text-3xl","font-bold","text-gray-900"],[1,"font-bold",2,"color","#ff8633"],[1,"flex-grow","px-4","py-2","overflow-y-auto","mb-48"],["class","bg-white shadow-lg rounded-lg flex justify-between items-center p-4 mb-4 space-x-4 sm:space-x-6 md:space-x-8",4,"ngFor","ngForOf"],[1,"fixed","bottom-0","w-full","p-4","bg-white","shadow-lg","border-t-2"],[1,"bg-white","p-2","sm:p-4","md:p-6","rounded-lg","shadow-md"],[1,"flex","justify-between"],[1,"text-gray-700","text-sm","sm:text-base","md:text-lg"],[1,"font-semibold","text-sm","sm:text-base","md:text-lg"],[1,"flex","justify-between","font-bold","text-gray-900","text-sm","sm:text-base","md:text-lg"],[1,"w-full","text-white","font-bold","py-1","sm:py-2","md:py-3","mt-3","rounded",3,"click","disabled","ngClass"],[3,"carritoVaciado","abrirFeedback","totalCompra","carritoConsulta"],[1,"bg-white","shadow-lg","rounded-lg","flex","justify-between","items-center","p-4","mb-4","space-x-4","sm:space-x-6","md:space-x-8"],[1,"w-12","h-12","sm:w-16","sm:h-16","md:w-20","md:h-20","rounded-lg",3,"src","alt"],[1,"flex-grow","px-2","sm:px-4"],[1,"text-base","sm:text-lg","md:text-xl","font-semibold","text-gray-900"],[1,"text-sm","sm:text-md","md:text-lg","text-gray-700"],[1,"flex","items-center","space-x-1","sm:space-x-2"],[1,"bg-[#ff8633]","text-white","px-1","sm:px-2","py-1","rounded","hover:bg-[#ff6133]",3,"click"],["name","remove-circle-outline"],[1,"text-sm","sm:text-lg","font-semibold"],["name","add-circle-outline"],["name","trash-outline"]],template:function(t,o){if(1&t){const i=e.RV6();e.j41(0,"ion-content",2)(1,"div",3),e.nrm(2,"img",4),e.j41(3,"div")(4,"h4",5),e.EFF(5,"QuickDineHub"),e.k0s()()(),e.j41(6,"div",6)(7,"h1",7)(8,"span",8),e.EFF(9,"Carrito"),e.k0s(),e.EFF(10," de compras "),e.k0s()(),e.j41(11,"div",9),e.DNE(12,M,16,5,"div",10),e.k0s(),e.j41(13,"div",11)(14,"div",12)(15,"div",13)(16,"span",14),e.EFF(17,"Subtotal"),e.k0s(),e.j41(18,"span",15),e.EFF(19),e.k0s()(),e.j41(20,"div",13)(21,"span",14),e.EFF(22,"Env\xedo"),e.k0s(),e.j41(23,"span",15),e.EFF(24),e.k0s()(),e.j41(25,"div",16)(26,"span"),e.EFF(27,"Total"),e.k0s(),e.j41(28,"span"),e.EFF(29),e.k0s()()(),e.j41(30,"button",17),e.bIt("click",function(){e.eBV(i);const c=e.sdS(33);return e.Njj(c.openModal())}),e.EFF(31," Comprar "),e.k0s(),e.j41(32,"app-pasarela-pagos",18,0),e.bIt("carritoVaciado",function(){return e.eBV(i),e.Njj(o.cargarProductosCarrito())})("carritoVaciado",function(){return e.eBV(i),e.Njj(o.obtenerDatoComensal())})("abrirFeedback",function(){return e.eBV(i),e.Njj(o.mostrarModalFeedback())}),e.k0s(),e.nrm(34,"app-feedback-formulario",null,1),e.k0s()()}2&t&&(e.Y8G("fullscreen",!0),e.R7$(12),e.Y8G("ngForOf",o.productosCarrito),e.R7$(7),e.SpI("$",o.subtotalCompra,""),e.R7$(5),e.SpI("$",o.envio,""),e.R7$(5),e.SpI("$",o.totalCompra,""),e.R7$(),e.Y8G("disabled",o.botonesDeshabilitados)("ngClass",e.l_i(9,X,!o.botonesDeshabilitados,o.botonesDeshabilitados)),e.R7$(2),e.Y8G("totalCompra",o.totalCompra)("carritoConsulta",o.carritoConsulta))},dependencies:[p.W9,p.iq,h.YU,h.Sq,G,O]}),s})()}];let Q=(()=>{var r;class s{}return(r=s).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[l.iI.forChild(Y),l.iI]}),s})(),H=(()=>{var r;class s{}return(r=s).\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[p.bv,h.MD,f.YN,k.S,Q]}),s})()}}]);